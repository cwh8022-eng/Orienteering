<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>淡江大學定向運動闖關挑戰（先測上傳版｜JSON 模式）</title>

<!-- 使用你本機的樣式檔（無需 CDN） -->
<link rel="stylesheet" href="./styles.css" />

<style>
  :root { --accent:#f97316; --ok:#22c55e; }
  .pill{
    width:72px;height:72px;display:flex;align-items:center;justify-content:center;
    border-radius:0.9rem;background:var(--accent);color:#fff;font-weight:800;font-size:1.1rem
  }
  .pill.done{ background:var(--ok); }
  .badge { border:1px dashed #e5e7eb; border-radius:.75rem; padding:.6rem; text-align:center; font-size:.85rem }
  .badge.done{ border-style:solid; background:#f0fdf4; }
  .modal-mask{ position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:50; }
  .modal-card{ width:min(560px,92vw); background:#fff; border-radius:1rem; padding:1rem; box-shadow:0 20px 60px rgba(0,0,0,.25) }
  /* 預覽與彈窗滾動修正（避免按鈕被擠掉） */
  #taskModal .modal-card{ max-height:90vh; overflow-y:auto; -webkit-overflow-scrolling:touch; }
  #previewImg{ width:100%; height:auto; max-height:16rem; object-fit:contain; }
</style>
</head>
<body class="bg-orange-50/40 text-slate-800">
<header class="max-w-6xl mx-auto px-4 py-6 flex items-center gap-4">
  <div class="w-12 h-12 rounded-2xl bg-[var(--accent)] text-white grid place-items-center font-extrabold">TKU</div>
  <div>
    <h1 class="text-2xl md:text-3xl font-extrabold">淡江大學定向運動闖關挑戰</h1>
    <p class="text-slate-600">先測「自拍→上傳到 Google Drive」流程（JSON 上傳）；之後再接上 AI 模型。</p>
  </div>
  <div class="ms-auto flex gap-2">
    <button id="howBtn" class="px-3 py-2 rounded-xl bg-white border border-slate-200 hover:bg-slate-50">規則說明</button>
    <button id="idBtn"  class="px-3 py-2 rounded-xl bg-white border border-slate-200 hover:bg-slate-50">設定學號</button>
  </div>
</header>

<section class="max-w-6xl mx-auto px-4">
  <div class="grid md:grid-cols-3 gap-4 items-stretch">
    <div class="col-span-2 bg-white rounded-2xl p-4 border border-slate-200">
      <div class="flex items-center justify-between mb-2">
        <h2 class="font-bold">我的闖關進度</h2>
        <button id="resetBtn" class="text-sm text-slate-500 hover:text-red-600">清除進度</button>
      </div>
      <div class="w-full bg-slate-100 rounded-xl h-3">
        <div id="progressBar" class="bg-[var(--accent)] h-3 rounded-xl" style="width:0%"></div>
      </div>
      <p id="progressText" class="text-sm mt-2 text-slate-600">已完成 0 / 25</p>
      <p class="text-xs mt-1 text-slate-500">學號：<span id="sidVal">（未設定）</span></p>
    </div>
    <div class="bg-white rounded-2xl p-4 border border-slate-200">
      <h2 class="font-bold mb-2">快速動作</h2>
      <div class="flex flex-wrap gap-2">
        <button id="startBtn" class="px-3 py-2 rounded-xl bg-[var(--accent)] text-white hover:opacity-90">開始挑戰</button>
        <button id="badgesBtn" class="px-3 py-2 rounded-xl bg-white border border-slate-200 hover:bg-slate-50">我的徽章</button>
      </div>
      <p class="text-xs text-slate-500 mt-3">注意：需自拍入鏡；目前不做 AI 驗證，僅測試上傳。</p>
    </div>
  </div>
</section>

<section class="max-w-6xl mx-auto px-4 mt-6">
  <div class="bg-white rounded-2xl p-3 border border-slate-200">
    <h2 class="font-bold mb-3">校園地圖（參考）</h2>
    <img src="assets/tku_map.jpg" class="w-full h-auto rounded-xl border border-slate-200"
         onerror="this.nextElementSibling.classList.remove('hidden')" alt="map"/>
    <div class="hidden mt-2 text-sm text-red-600">找不到地圖：<code>assets/tku_map.jpg</code></div>
  </div>
</section>

<section class="max-w-6xl mx-auto px-4 mt-6">
  <div class="bg-white rounded-2xl p-3 border border-slate-200">
    <h2 class="font-bold mb-3">拍照目標一覽（#1–#25）</h2>
    <img src="assets/tku_targets.jpg" class="w-full h-auto rounded-xl border border-slate-200"
         onerror="this.nextElementSibling.classList.remove('hidden')" alt="targets"/>
    <div class="hidden mt-2 text-sm text-red-600">找不到拼圖：<code>assets/tku_targets.jpg</code></div>
    <p class="text-xs text-slate-500 mt-2">只顯示編號，不提供中文提示。</p>
  </div>
</section>

<section class="max-w-6xl mx-auto px-4 mt-6">
  <div class="bg-white rounded-2xl p-4 border border-slate-200">
    <h2 class="font-bold mb-3">關卡列表（點擊編號上傳）</h2>
    <div id="poiList" class="grid grid-cols-5 gap-3"></div>
  </div>
</section>

<section class="max-w-6xl mx-auto px-4 mt-6 mb-20">
  <div class="bg-white rounded-2xl p-4 border border-slate-200">
    <div class="flex items-center gap-3 mb-3">
      <h2 class="font-bold">徽章收集</h2>
      <span class="text-xs text-slate-500">蒐集 25 枚徽章，即完成最終挑戰！</span>
    </div>
    <div id="badgeGrid" class="grid grid-cols-5 sm:grid-cols-6 lg:grid-cols-8 gap-3"></div>
  </div>
</section>

<!-- 規則 Modal -->
<div id="howModal" class="modal-mask">
  <div class="modal-card">
    <div class="flex items-center justify-between mb-2">
      <h3 class="font-bold text-lg">遊戲規則（目前為上傳測試模式）</h3>
      <button class="text-slate-500" onclick="toggleHow(false)">✕</button>
    </div>
    <ol class="list-decimal ps-5 space-y-1 text-slate-700">
      <li>在關卡列表點選編號（#1~#25）。</li>
      <li>自拍並拍下該編號的標的物。</li>
      <li>按「上傳到 Google Drive」後，會直接送到雲端（暫不做 AI 驗證）。</li>
      <li>進度儲存在本機；集滿 25 枚徽章完成挑戰。</li>
    </ol>
    <div class="mt-4 text-right"><button class="px-3 py-2 rounded-xl bg-[var(--accent)] text-white" onclick="toggleHow(false)">我知道了</button></div>
  </div>
</div>

<!-- 上傳 Modal -->
<div id="taskModal" class="modal-mask">
  <div class="modal-card">
    <div class="flex items-start justify-between gap-3">
      <div>
        <h3 id="taskTitle" class="font-bold text-lg">#</h3>
        <p id="taskSubtitle" class="text-sm text-slate-500">請自拍並拍下此編號的標的物（目前不驗證 AI）</p>
      </div>
      <button class="text-slate-500" onclick="toggleTask(false)">✕</button>
    </div>
    <div class="mt-3">
      <div class="rounded-xl border border-dashed border-slate-300 p-3">
        <input id="imageInput" type="file" accept="image/*;capture=camera" class="block w-full text-sm" />
        <p class="text-xs text-slate-500 mt-1">手機會直接開啟相機；請確保本人入鏡。</p>
      </div>
      <div id="previewWrap" class="mt-3 hidden">
        <img id="previewImg" class="rounded-xl border border-slate-200" alt="預覽"
